name: MLOps pipeline Project Diabetes prediction
on:
  workflow_dispatch:
jobs:
  register-dataset:
    runs-on: ubuntu-latest
    env:
      # Setting these globally for the whole job
      HF_TOKEN: ${{ secrets.HF_TOKEN }}
      HF_USERNAME: ${{secrets.HF_USERNAME}}
      # Also expose the token under the name huggingface_hub commonly reads
      HUGGINGFACE_HUB_TOKEN: ${{ secrets.HF_TOKEN }}
      PYTHONPATH: .
      BASE_PATH: MLOps/PIMA_Diabetes_Prediction/self_paced_courses_1_mlops
    steps:
      - uses: actions/checkout@v3
      - name: Install Dependencies
        run: pip install -r ${{env.BASE_PATH}}/requirements.txt
      - name: Debug workspace (show files & paths)
        run:  |
            echo "GITHUB_WORKSPACE: $GITHUB_WORKSPACE"
            echo "BASE_PATH: $BASE_PATH"
            pwd
            ls -la
            echo "Listing BASE_PATH:"
            ls -la "$BASE_PATH" || true
            echo "Listing BASE_PATH/data:"
            ls -la "$BASE_PATH/data" || true
            echo "Listing repo-root data:"
            ls -la /data || true 

      - name: 1. Upload Dataset to Hugging Face Hub
        working-directory: ${{ env.BASE_PATH }}
        #run: python ${{ env.BASE_PATH }}/model_building/data_register.py
        run: python model_building/data_register.py


  data-prep:
    needs: register-dataset
    runs-on: ubuntu-latest
    env:
      BASE_PATH: MLOps/PIMA_Diabetes_Prediction/self_paced_courses_1_mlops
      HF_USERNAME: ${{secrets.HF_USERNAME}}
    steps:
      - uses: actions/checkout@v3
      - name: Install Dependencies
        run: pip install -r ${{env.BASE_PATH}}/requirements.txt
      - name: 2. Run Data Preparation
        run: python ${{ env.BASE_PATH }}/model_building/prep.py

