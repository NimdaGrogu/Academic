name: MLOps github pipeline
on:
  workflow_dispatch:
jobs:
    mlops-pipeline:
      runs-on: ubuntu-latest
      env:
        # Setting these globally for the whole job
        HF_TOKEN: ${{ secrets.HF_TOKEN }}
        HF_USERNAME: ${{secrets.HF_USERNAME}}
        # Also expose the token under the name huggingface_hub commonly reads
        HUGGINGFACE_HUB_TOKEN: ${{ secrets.HF_TOKEN }}
        PYTHONPATH: .
        BASE_PATH: MLOps/PIMA_Diabetes_Prediction/self_paced_courses_1_mlops

      steps:
        - uses: actions/checkout@v4 # Updated to latest version
        - name: Set up Python
          uses: actions/setup-python@v4
          with:
            python-version: '3.10'
            cache: 'pip' # Speeds up future runs by caching dependencies

        - name: Install Dependencies
          run: pip install -r ${{ env.BASE_PATH }}/requirements.txt

        - name: Debug workspace (show files & paths)
          run: |
            echo "GITHUB_WORKSPACE: $GITHUB_WORKSPACE"
            echo "BASE_PATH: $BASE_PATH"
            pwd
            ls -la
            echo "Listing BASE_PATH:"
            ls -la "$BASE_PATH" || true
            echo "Listing BASE_PATH/data:"
            ls -la "$BASE_PATH/data" || true
            echo "Listing repo-root data:"
            ls -la /data || true 

        - name: 1. Register Dataset
          working-directory: ${{ env.BASE_PATH }}
          #run: python ${{ env.BASE_PATH }}/model_building/data_register.py
          run: python model_building/data_register.py

        - name: 2. Data Preparation
          working-directory: ${{ env.BASE_PATH }}
          run: python model_building/prep.py

        - name: 3. Model Training
          working-directory: ${{ env.BASE_PATH }}
          run: python model_building/train.py

        - name: 4. Deploy to Hosting
          working-directory: ${{ env.BASE_PATH }}
          run: python hosting/hosting.py

